<!DOCTYPE HTML>

<html><head><meta charset="utf-8"/><title>Data.FingerTree</title><link href="Agda.css" rel="stylesheet"/></head><body><pre><a class="Comment" id="1">-- Donnacha Oisín Kidney                                ABOUT CONTACT FEED SNIPPETS</a>
<a class="Comment" id="85">-- ================================================================================</a>

<a class="Comment" id="170">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="254">-- │         oooooooooooo  o8o                                                    │</a>
<a class="Comment" id="338">-- │         `888'     `8  `"'                                                    │</a>
<a class="Comment" id="422">-- │          888         oooo  ooo. .oo.    .oooooooo  .ooooo.  oooo d8b         │</a>
<a class="Comment" id="506">-- │          888oooo8    `888  `888P"Y88b  888' `88b  d88' `88b `888""8P         │</a>
<a class="Comment" id="590">-- │          888    "     888   888   888  888   888  888ooo888  888             │</a>
<a class="Comment" id="674">-- │          888          888   888   888  `88bod8P'  888    .o  888             │</a>
<a class="Comment" id="758">-- │         o888o        o888o o888o o888o `8oooooo.  `Y8bod8P' d888b            │</a>
<a class="Comment" id="842">-- │                                        d"     YD                             │</a>
<a class="Comment" id="926">-- │                                        "Y88888P'                             │</a>
<a class="Comment" id="1010">-- │                                                                              │</a>
<a class="Comment" id="1094">-- │   ooooooooooooo                                          ooooo               │</a>
<a class="Comment" id="1178">-- │   8'   888   `8                                          `888'               │</a>
<a class="Comment" id="1262">-- │        888      oooo d8b  .ooooo.   .ooooo.   .oooo.o     888  ooo. .oo.     │</a>
<a class="Comment" id="1346">-- │        888      `888""8P d88' `88b d88' `88b d88(  "8     888  `888P"Y88b    │</a>
<a class="Comment" id="1430">-- │        888       888     888ooo888 888ooo888 `"Y88b.      888   888   888    │</a>
<a class="Comment" id="1514">-- │        888       888     888    .o 888    .o o.  )88b     888   888   888    │</a>
<a class="Comment" id="1598">-- │       o888o     d888b    `Y8bod8P' `Y8bod8P' 8""888P'    o888o o888o o888o   │</a>
<a class="Comment" id="1682">-- │                                                                              │</a>
<a class="Comment" id="1766">-- │                                                                              │</a>
<a class="Comment" id="1850">-- │                                                                              │</a>
<a class="Comment" id="1934">-- │                     .o.                        .o8                           │</a>
<a class="Comment" id="2018">-- │                    .888.                      "888                           │</a>
<a class="Comment" id="2102">-- │                   .8"888.      .oooooooo  .oooo888   .oooo.                  │</a>
<a class="Comment" id="2186">-- │                  .8' `888.    888' `88b  d88' `888  `P  )88b                 │</a>
<a class="Comment" id="2270">-- │                 .88ooo8888.   888   888  888   888   .oP"888                 │</a>
<a class="Comment" id="2354">-- │                .8'     `888.  `88bod8P'  888   888  d8(  888                 │</a>
<a class="Comment" id="2438">-- │               o88o     o8888o `8oooooo.  `Y8bod88P" `Y888""8o                │</a>
<a class="Comment" id="2522">-- │                               d"     YD                                      │</a>
<a class="Comment" id="2606">-- │                               "Y88888P'                                      │</a>
<a class="Comment" id="2690">-- └──────────────────────────────────────────────────────────────────────────────┘</a>

<a class="Comment" id="2775">-- Posted on February 25, 2019</a>


<a class="Keyword" id="2808">open</a> <a class="Keyword" id="2813">import</a> <a class="Module" href="Data.FingerTree.Preamble.html" id="2820">Data.FingerTree.Preamble</a>

<a class="Keyword" id="2846">module</a> <a class="Module" href="Data.FingerTree.html" id="2853">Data.FingerTree</a>
  <a class="Symbol" id="2871">{</a><a class="Bound" href="Data.FingerTree.html#2872" id="2872">c</a> <a class="Bound" href="Data.FingerTree.html#2874" id="2874">m</a> <a class="Bound" href="Data.FingerTree.html#2876" id="2876">a</a><a class="Symbol" id="2877">}</a>
  <a class="Symbol" id="2881">(</a><a class="Bound" href="Data.FingerTree.html#2882" id="2882">imports</a> <a class="Symbol" id="2890">:</a> <a class="Record" href="Data.FingerTree.Preamble.html#363" id="2892">Imports</a> <a class="Bound" href="Data.FingerTree.html#2872" id="2900">c</a> <a class="Bound" href="Data.FingerTree.html#2874" id="2902">m</a> <a class="Bound" href="Data.FingerTree.html#2876" id="2904">a</a><a class="Symbol" id="2905">)</a>
  <a class="Keyword" id="2909">where</a>

<a class="Keyword" id="2916">open</a> <a class="Module" href="Data.FingerTree.Preamble.html#363" id="2921">Imports</a> <a class="Bound" href="Data.FingerTree.html#2882" id="2929">imports</a>
<a class="Keyword" id="2937">import</a> <a class="Module" href="Data.FingerTree.Measures.html" id="2944">Data.FingerTree.Measures</a>
<a class="Keyword" id="2969">module</a> <a id="Measures"></a><a class="Module" href="Data.FingerTree.html#2976" id="2976">Measures</a> <a class="Symbol" id="2985">=</a> <a class="Module" href="Data.FingerTree.Measures.html" id="2987">Data.FingerTree.Measures</a> <a class="Field" href="Data.FingerTree.Preamble.html#421" id="3012">ℳ</a>

<a class="Comment" id="3015">-- As I have talked about previously, a large class of divide-and conquer</a>
<a class="Comment" id="3089">-- algorithms rely on "good" partitioning for the divide step. If you then want to</a>
<a class="Comment" id="3172">-- make the algorithms incremental, you keep all of those partitions (with their</a>
<a class="Comment" id="3253">-- summaries) in some "good" arrangement [1]. Several common data structures are</a>
<a class="Comment" id="3334">-- designed around this principle: binomial heaps, for instance, store partitions</a>
<a class="Comment" id="3416">-- of size 2ⁿ. Different ways of storing partitions favours different use cases:</a>
<a class="Comment" id="3497">-- switch from a binomial heap to a skew binomial, for instance, and you get</a>
<a class="Comment" id="3574">-- constant-time cons.</a>

<a class="Comment" id="3598">-- The standout data structure in this area is Hinze and Paterson's finger tree</a>
<a class="Comment" id="3678">-- [2]. It caches summaries in a pretty amazing way, allowing for (amortised) 𝒪(1)</a>
<a class="Comment" id="3761">-- cons and snoc and 𝒪(log n) split and append. These features allow it to be used</a>
<a class="Comment" id="3844">-- for a huge variety of things: Data.Sequence uses it as a random-access sequence,</a>
<a class="Comment" id="3928">-- but it can also work as a priority queue, a search tree, a priority search tree</a>
<a class="Comment" id="4011">-- [3], an interval tree, an order statistic tree...</a>

<a class="Comment" id="4065">-- All of these applications solely rely on an underlying monoid. As a result, I</a>
<a class="Comment" id="4146">-- thought it would be a great data structure to implement in Agda, so that you'd</a>
<a class="Comment" id="4228">-- get all of the other data structures with minimal effort [similar thinking</a>
<a class="Comment" id="4306">-- motivated a Coq implementation; 4]</a>

<a class="Keyword" id="4345">module</a> <a class="Module" href="Data.FingerTree.html#4352" id="4352">_</a> <a class="Keyword" id="4354">where</a>
 <a class="Keyword" id="4361">open</a> <a class="Module" href="Data.FingerTree.html#2976" id="4366">Measures</a>

<a class="Comment" id="4376">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="4460">-- │                                                                              │</a>
<a class="Comment" id="4544">-- │                    ____                                __                    │</a>
<a class="Comment" id="4628">-- │                   / ___|  ___ ___  _ __   ___    ___  / _|                   │</a>
<a class="Comment" id="4712">-- │                   \___ \ / __/ _ \| '_ \ / _ \  / _ \| |_                    │</a>
<a class="Comment" id="4796">-- │                    ___) | (_| (_) | |_) |  __/ | (_) |  _|                   │</a>
<a class="Comment" id="4880">-- │                   |____/ \___\___/| .__/ \___|  \___/|_|                     │</a>
<a class="Comment" id="4964">-- │                                   |_|                                        │</a>
<a class="Comment" id="5048">-- │             __     __        _  __ _           _   _                         │</a>
<a class="Comment" id="5132">-- │             \ \   / /__ _ __(_)/ _(_) ___ __ _| |_(_) ___  _ __              │</a>
<a class="Comment" id="5216">-- │              \ \ / / _ \ '__| | |_| |/ __/ _` | __| |/ _ \| '_ \             │</a>
<a class="Comment" id="5300">-- │               \ V /  __/ |  | |  _| | (_| (_| | |_| | (_) | | | |            │</a>
<a class="Comment" id="5384">-- │                \_/ \___|_|  |_|_| |_|\___\__,_|\__|_|\___/|_| |_|            │</a>
<a class="Comment" id="5468">-- │                                                                              │</a>
<a class="Comment" id="5552">-- └──────────────────────────────────────────────────────────────────────────────┘</a>

<a class="Comment" id="5637">-- There would be no real point to implementing a finger tree in Agda if we didn't</a>
<a class="Comment" id="5720">-- also prove some things about it. The scope of the proofs I've done so far are</a>
<a class="Comment" id="5801">-- intrinsic proofs of the summaries in the tree. In other words, the type of</a>
<a class="Comment" id="5879">-- cons is as follows:</a>

 <a class="Function" href="Data.FingerTree.html#5904" id="5904">_</a> <a class="Symbol" id="5906">:</a> <a class="Symbol" id="5908">(</a><a class="Bound" href="Data.FingerTree.html#5909" id="5909">x</a> <a class="Symbol" id="5911">:</a> <a class="Field" href="Data.FingerTree.Preamble.html#509" id="5913">A</a><a class="Symbol" id="5914">)</a> <a class="Symbol" id="5916">→</a> <a class="Symbol" id="5918">(</a><a class="Bound" href="Data.FingerTree.html#5919" id="5919">xs</a> <a class="Symbol" id="5922">:</a> <a class="Datatype" href="Data.FingerTree.Structures.html#1236" id="5924">Tree</a> <a class="Field" href="Data.FingerTree.Preamble.html#509" id="5929">A</a><a class="Symbol" id="5930">)</a> <a class="Symbol" id="5932">→</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="5934">μ⟨</a> <a class="Datatype" href="Data.FingerTree.Structures.html#1236" id="5937">Tree</a> <a class="Field" href="Data.FingerTree.Preamble.html#509" id="5942">A</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="5944">⟩≈</a> <a class="Symbol" id="5947">(</a><a class="Field" href="Data.FingerTree.Measures.html#361" id="5948">μ</a> <a class="Bound" href="Data.FingerTree.html#5909" id="5950">x</a> <a class="Function Operator" href="https://agda.github.io/agda-stdlib/Algebra.html#2653" id="5952">∙</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="5954">μ</a> <a class="Bound" href="Data.FingerTree.html#5919" id="5956">xs</a><a class="Symbol" id="5958">)</a>
 <a class="Symbol" id="5961">_</a> <a class="Symbol" id="5963">=</a> <a class="Function Operator" href="Data.FingerTree.Cons.html#447" id="5965">_◂_</a>

<a class="Comment" id="5970">-- This is enough to prove things about the derived data structures (like the</a>
<a class="Comment" id="6048">-- correctness of sorting if it's used as a priority queue), but it's worth</a>
<a class="Comment" id="6124">-- pointing out what I *haven't* proved (yet):</a>
<a class="Comment" id="6171">--</a>
<a class="Comment" id="6174">--   1. Invariants on the structure ("safe" and "unsafe" digits and so on).</a>
<a class="Comment" id="6250">--   2. The time complexity or performance of any operations.</a>
<a class="Comment" id="6312">--</a>
<a class="Comment" id="6315">-- To be honest, I'm not even sure that my current implementation is correct in</a>
<a class="Comment" id="6395">-- these regards! I'll probably have a go at proving them in the future [possibly</a>
<a class="Comment" id="6477">-- using 5].</a>

<a class="Comment" id="6491">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="6575">-- │                                                                              │</a>
<a class="Comment" id="6659">-- │           __  __                   _     _                       _           │</a>
<a class="Comment" id="6743">-- │          |  \/  | ___  _ __   ___ (_) __| |___    __ _ _ __   __| |          │</a>
<a class="Comment" id="6827">-- │          | |\/| |/ _ \| '_ \ / _ \| |/ _` / __|  / _` | '_ \ / _` |          │</a>
<a class="Comment" id="6911">-- │          | |  | | (_) | | | | (_) | | (_| \__ \ | (_| | | | | (_| |          │</a>
<a class="Comment" id="6995">-- │          |_|  |_|\___/|_| |_|\___/|_|\__,_|___/  \__,_|_| |_|\__,_|          │</a>
<a class="Comment" id="7079">-- │                                                                              │</a>
<a class="Comment" id="7163">-- │                         ____                   __                            │</a>
<a class="Comment" id="7247">-- │                        |  _ \ _ __ ___   ___  / _|___                        │</a>
<a class="Comment" id="7331">-- │                        | |_) | '__/ _ \ / _ \| |_/ __|                       │</a>
<a class="Comment" id="7415">-- │                        |  __/| | | (_) | (_) |  _\__ \                       │</a>
<a class="Comment" id="7499">-- │                        |_|   |_|  \___/ \___/|_| |___/                       │</a>
<a class="Comment" id="7583">-- │                                                                              │</a>
<a class="Comment" id="7667">-- └──────────────────────────────────────────────────────────────────────────────┘</a>

<a class="Comment" id="7752">-- The bad news is that finger trees are a relatively complex data structure, and</a>
<a class="Comment" id="7834">-- we're going to need a *lot* of proofs to write a verified version. The good news</a>
<a class="Comment" id="7918">-- is that monoids (in contrast to rings) are extremely easy to prove</a>
<a class="Comment" id="7988">-- automatically. In this project, I used reflection to do so, but I think it</a>
<a class="Comment" id="8066">-- should be possible to do with instance resolution also. The monoid solver is</a>
<a class="Comment" id="8146">-- here:</a>

<a class="Keyword" id="8156">import</a> <a class="Module" href="https://agda.github.io/agda-stdlib/MonoidSolver.html" id="8163">MonoidSolver</a>

<a class="Comment" id="8177">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="8261">-- │                                                                              │</a>
<a class="Comment" id="8345">-- │                                                                              │</a>
<a class="Comment" id="8429">-- │                                                                              │</a>
<a class="Comment" id="8513">-- │                                                                              │</a>
<a class="Comment" id="8597">-- │                                                                              │</a>
<a class="Comment" id="8681">-- │                   __  __                                                     │</a>
<a class="Comment" id="8765">-- │                  |  \/  | ___  __ _ ___ _   _ _ __ ___  ___                  │</a>
<a class="Comment" id="8849">-- │                  | |\/| |/ _ \/ _` / __| | | | '__/ _ \/ __|                 │</a>
<a class="Comment" id="8933">-- │                  | |  | |  __/ (_| \__ \ |_| | | |  __/\__ \                 │</a>
<a class="Comment" id="9017">-- │                  |_|  |_|\___|\__,_|___/\__,_|_|  \___||___/                 │</a>
<a class="Comment" id="9101">-- │                                                                              │</a>
<a class="Comment" id="9185">-- │                                                                              │</a>
<a class="Comment" id="9269">-- │                                                                              │</a>
<a class="Comment" id="9353">-- │                                                                              │</a>
<a class="Comment" id="9437">-- │                                                                              │</a>
<a class="Comment" id="9521">-- └──────────────────────────────────────────────────────────────────────────────┘</a>
<a class="Comment" id="9605">--</a>
<a class="Comment" id="9608">-- First things first, we need a way to talk about the summaries of elements we're</a>
<a class="Comment" id="9691">-- interested in. This is captured by the σ class, which has one method μ.</a>

<a class="Function" href="Data.FingerTree.html#9767" id="9767">_</a> <a class="Symbol" id="9769">:</a> <a class="Symbol" id="9771">∀</a> <a class="Symbol" id="9773">{</a><a class="Bound" href="Data.FingerTree.html#9774" id="9774">a</a><a class="Symbol" id="9775">}</a> <a class="Symbol" id="9777">{</a><a class="Bound" href="Data.FingerTree.html#9778" id="9778">A</a> <a class="Symbol" id="9780">:</a> <a class="PrimitiveType" id="9782">Set</a> <a class="Bound" href="Data.FingerTree.html#9774" id="9786">a</a><a class="Symbol" id="9787">}</a> <a class="Symbol" id="9789">⦃</a> <a class="Bound" href="Data.FingerTree.html#9791" id="9791">_</a> <a class="Symbol" id="9793">:</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="9795">σ</a> <a class="Bound" href="Data.FingerTree.html#9778" id="9797">A</a> <a class="Symbol" id="9799">⦄</a> <a class="Symbol" id="9801">→</a> <a class="Bound" href="Data.FingerTree.html#9778" id="9803">A</a> <a class="Symbol" id="9805">→</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2603" id="9807">𝓡</a>
<a class="Symbol" id="9809">_</a> <a class="Symbol" id="9811">=</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="9813">μ</a>

<a class="Comment" id="9816">-- 𝓡 is the type of the summaries, and μ means "summarise". The silly symbols</a>
<a class="Comment" id="9894">-- are used for brevity: we're going to be using this thing everywhere, so it's</a>
<a class="Comment" id="9974">-- important to keep it short. Here's an example instance for lists:</a>

<a class="Function" href="Data.FingerTree.html#10044" id="10044">_</a> <a class="Symbol" id="10046">:</a> <a class="Symbol" id="10048">(</a><a class="Bound" href="Data.FingerTree.html#10049" id="10049">xs</a> <a class="Symbol" id="10052">:</a> <a class="Datatype" href="https://agda.github.io/agda-stdlib/Agda.Builtin.List.html#80" id="10054">List</a> <a class="Field" href="Data.FingerTree.Preamble.html#509" id="10059">A</a><a class="Symbol" id="10060">)</a> <a class="Symbol" id="10062">→</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="10064">μ</a> <a class="Bound" href="Data.FingerTree.html#10049" id="10066">xs</a> <a class="Datatype Operator" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" id="10069">≡</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Data.List.Base.html#3600" id="10071">foldr</a> <a class="Symbol" id="10077">(</a><a class="Function Operator" href="https://agda.github.io/agda-stdlib/Algebra.html#2653" id="10078">_∙_</a> <a class="Function Operator" href="https://agda.github.io/agda-stdlib/Function.html#805" id="10082">∘</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="10084">μ</a><a class="Symbol" id="10085">)</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2680" id="10087">ε</a> <a class="Bound" href="Data.FingerTree.html#10049" id="10089">xs</a>
<a class="Symbol" id="10092">_</a> <a class="Symbol" id="10094">=</a> <a class="Symbol" id="10096">λ</a> <a class="Bound" href="Data.FingerTree.html#10098" id="10098">xs</a> <a class="Symbol" id="10101">→</a> <a class="InductiveConstructor" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" id="10103">refl</a>

<a class="Comment" id="10109">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="10193">-- │                                                                              │</a>
<a class="Comment" id="10277">-- │                                                                              │</a>
<a class="Comment" id="10361">-- │        __        __         _    _                        _ _   _            │</a>
<a class="Comment" id="10445">-- │        \ \      / /__  _ __| | _(_)_ __   __ _  __      _(_) |_| |__         │</a>
<a class="Comment" id="10529">-- │         \ \ /\ / / _ \| '__| |/ / | '_ \ / _` | \ \ /\ / / | __| '_ \        │</a>
<a class="Comment" id="10613">-- │          \ V  V / (_) | |  |   &lt;| | | | | (_| |  \ V  V /| | |_| | | |       │</a>
<a class="Comment" id="10697">-- │           \_/\_/ \___/|_|  |_|\_\_|_| |_|\__, |   \_/\_/ |_|\__|_| |_|       │</a>
<a class="Comment" id="10781">-- │                                          |___/                               │</a>
<a class="Comment" id="10865">-- │                        ____       _        _     _                           │</a>
<a class="Comment" id="10949">-- │                       / ___|  ___| |_ ___ (_) __| |___                       │</a>
<a class="Comment" id="11033">-- │                       \___ \ / _ \ __/ _ \| |/ _` / __|                      │</a>
<a class="Comment" id="11117">-- │                        ___) |  __/ || (_) | | (_| \__ \                      │</a>
<a class="Comment" id="11201">-- │                       |____/ \___|\__\___/|_|\__,_|___/                      │</a>
<a class="Comment" id="11285">-- │                                                                              │</a>
<a class="Comment" id="11369">-- │                                                                              │</a>
<a class="Comment" id="11453">-- └──────────────────────────────────────────────────────────────────────────────┘</a>

<a class="Comment" id="11538">-- As I mentioned, the tree is going to be verified intrinsically. In other word</a>
<a class="Comment" id="11619">-- its type will look something like this:</a>

<a id="SimpleTree"></a><a class="Function" href="Data.FingerTree.html#11663" id="11663">SimpleTree</a> <a class="Symbol" id="11674">:</a> <a class="PrimitiveType" id="11676">Set</a> <a class="Symbol" id="11680">_</a>
<a class="Function" href="Data.FingerTree.html#11663" id="11682">SimpleTree</a> <a class="Symbol" id="11693">=</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2603" id="11695">𝓡</a> <a class="Symbol" id="11697">→</a> <a class="PrimitiveType" id="11699">Set</a>

<a class="Comment" id="11704">-- But before running off to define that the obvious way, I should mention that I</a>
<a class="Comment" id="11786">-- made the annoying decision to use a setoid (rather than propositional equality)</a>
<a class="Comment" id="11869">-- based monoid. This means that we don't get substitution, making the obvious</a>
<a class="Comment" id="11948">-- definition untenable.</a>

<a class="Comment" id="11974">-- I figured out a solution to the problem, but I'm not sure if I'm happy with it.</a>
<a class="Comment" id="12057">-- That's actually the main motivation for writing this post: I'm curious if other</a>
<a class="Comment" id="12140">-- people have better techniques for this kind of thing.</a>

<a class="Comment" id="12198">-- To clarify: "this kind of thing" is writing intrinsic (correct-by-construction)</a>
<a class="Comment" id="12281">-- proofs when a setoid is involved. Intrinsic proofs usually lend themselves to</a>
<a class="Comment" id="12362">-- elegance: to prove that `map` preserves a vector's length, for instance,</a>
<a class="Comment" id="12438">-- basically requires no proof at all:</a>

<a id="map"></a><a class="Function" href="Data.FingerTree.html#12478" id="12478">map</a> <a class="Symbol" id="12482">:</a> <a class="Symbol" id="12484">∀</a> <a class="Symbol" id="12486">{</a><a class="Bound" href="Data.FingerTree.html#12487" id="12487">a</a> <a class="Bound" href="Data.FingerTree.html#12489" id="12489">b</a> <a class="Bound" href="Data.FingerTree.html#12491" id="12491">n</a><a class="Symbol" id="12492">}</a> <a class="Symbol" id="12494">{</a><a class="Bound" href="Data.FingerTree.html#12495" id="12495">A</a> <a class="Symbol" id="12497">:</a> <a class="PrimitiveType" id="12499">Set</a> <a class="Bound" href="Data.FingerTree.html#12487" id="12503">a</a><a class="Symbol" id="12504">}</a> <a class="Symbol" id="12506">{</a><a class="Bound" href="Data.FingerTree.html#12507" id="12507">B</a> <a class="Symbol" id="12509">:</a> <a class="PrimitiveType" id="12511">Set</a> <a class="Bound" href="Data.FingerTree.html#12489" id="12515">b</a><a class="Symbol" id="12516">}</a>
    <a class="Symbol" id="12522">→</a> <a class="Symbol" id="12524">(</a><a class="Bound" href="Data.FingerTree.html#12495" id="12525">A</a> <a class="Symbol" id="12527">→</a> <a class="Bound" href="Data.FingerTree.html#12507" id="12529">B</a><a class="Symbol" id="12530">)</a>
    <a class="Symbol" id="12536">→</a> <a class="Datatype" href="https://agda.github.io/agda-stdlib/Data.Vec.html#773" id="12538">Vec</a> <a class="Bound" href="Data.FingerTree.html#12495" id="12542">A</a> <a class="Bound" href="Data.FingerTree.html#12491" id="12544">n</a>
    <a class="Symbol" id="12550">→</a> <a class="Datatype" href="https://agda.github.io/agda-stdlib/Data.Vec.html#773" id="12552">Vec</a> <a class="Bound" href="Data.FingerTree.html#12507" id="12556">B</a> <a class="Bound" href="Data.FingerTree.html#12491" id="12558">n</a>
<a class="Function" href="Data.FingerTree.html#12478" id="12560">map</a> <a class="Bound" href="Data.FingerTree.html#12564" id="12564">f</a> <a class="InductiveConstructor" href="https://agda.github.io/agda-stdlib/Data.Vec.html#813" id="12566">[]</a> <a class="Symbol" id="12569">=</a> <a class="InductiveConstructor" href="https://agda.github.io/agda-stdlib/Data.Vec.html#813" id="12571">[]</a>
<a class="Function" href="Data.FingerTree.html#12478" id="12574">map</a> <a class="Bound" href="Data.FingerTree.html#12578" id="12578">f</a> <a class="Symbol" id="12580">(</a><a class="Bound" href="Data.FingerTree.html#12581" id="12581">x</a> <a class="InductiveConstructor Operator" href="https://agda.github.io/agda-stdlib/Data.Vec.html#832" id="12583">∷</a> <a class="Bound" href="Data.FingerTree.html#12585" id="12585">xs</a><a class="Symbol" id="12587">)</a> <a class="Symbol" id="12589">=</a> <a class="Bound" href="Data.FingerTree.html#12578" id="12591">f</a> <a class="Bound" href="Data.FingerTree.html#12581" id="12593">x</a> <a class="InductiveConstructor Operator" href="https://agda.github.io/agda-stdlib/Data.Vec.html#832" id="12595">∷</a> <a class="Function" href="Data.FingerTree.html#12478" id="12597">map</a> <a class="Bound" href="Data.FingerTree.html#12578" id="12601">f</a> <a class="Bound" href="Data.FingerTree.html#12585" id="12603">xs</a>

<a class="Comment" id="12607">-- But that's because pattern matching works well with propositional equality: in</a>
<a class="Comment" id="12689">-- the first clause, n is set to 0 automatically. If we were working with</a>
<a class="Comment" id="12763">-- setoid equality, we'd instead maybe get a proof that n ≈ 0, and we'd have to</a>
<a class="Comment" id="12843">-- figure a way to work that into the types.</a>

<a class="Keyword" id="12889">open</a> <a class="Module" href="Data.FingerTree.html#2976" id="12894">Measures</a> <a class="Keyword" id="12903">hiding</a> <a class="Symbol" id="12910">(</a><a class="InductiveConstructor" href="Data.FingerTree.Measures.html#2635" id="12911">arg-syntax</a><a class="Symbol" id="12921">;</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#3143" id="12923">_&gt;&gt;=_</a><a class="Symbol" id="12928">;</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="12930">μ⟨_⟩≈_</a><a class="Symbol" id="12936">;</a> <a class="Field" href="Data.FingerTree.Measures.html#744" id="12938">𝓢</a><a class="Symbol" id="12939">;</a> <a class="Field" href="Data.FingerTree.Measures.html#754" id="12941">𝒻</a><a class="Symbol" id="12942">;</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#1444" id="12944">_≈[_]</a><a class="Symbol" id="12949">;</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="12951">σ</a><a class="Symbol" id="12952">;</a> <a class="Record" href="Data.FingerTree.Measures.html#2545" id="12954">Arg</a><a class="Symbol" id="12957">)</a>

<a class="Comment" id="12960">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="13044">-- │                                                                              │</a>
<a class="Comment" id="13128">-- │                                                                              │</a>
<a class="Comment" id="13212">-- │                                                                              │</a>
<a class="Comment" id="13296">-- │                                                                              │</a>
<a class="Comment" id="13380">-- │                                                                              │</a>
<a class="Comment" id="13464">-- │                          _____ _ _                                           │</a>
<a class="Comment" id="13548">-- │                         |  ___(_) |__  _ __ ___  ___                         │</a>
<a class="Comment" id="13632">-- │                         | |_  | | '_ \| '__/ _ \/ __|                        │</a>
<a class="Comment" id="13716">-- │                         |  _| | | |_) | | |  __/\__ \                        │</a>
<a class="Comment" id="13800">-- │                         |_|   |_|_.__/|_|  \___||___/                        │</a>
<a class="Comment" id="13884">-- │                                                                              │</a>
<a class="Comment" id="13968">-- │                                                                              │</a>
<a class="Comment" id="14052">-- │                                                                              │</a>
<a class="Comment" id="14136">-- │                                                                              │</a>
<a class="Comment" id="14220">-- │                                                                              │</a>
<a class="Comment" id="14304">-- └──────────────────────────────────────────────────────────────────────────────┘</a>

<a class="Keyword" id="14389">module</a> <a id="Fibre"></a><a class="Module" href="Data.FingerTree.html#14396" id="14396">Fibre</a> <a class="Keyword" id="14402">where</a>

<a class="Comment" id="14409">-- The first part of the solution is to define a wrapper type which stores</a>
<a class="Comment" id="14484">-- information about the size of the thing it contains:</a>

 <a class="Keyword" id="14542">record</a> <a id="Fibre.μ⟨_⟩≈_"></a><a class="Record Operator" href="Data.FingerTree.html#14549" id="14549">μ⟨_⟩≈_</a> <a class="Symbol" id="14556">{</a><a class="Bound" href="Data.FingerTree.html#14557" id="14557">a</a><a class="Symbol" id="14558">}</a> <a class="Symbol" id="14560">(</a><a class="Bound" href="Data.FingerTree.html#14561" id="14561">Σ</a> <a class="Symbol" id="14563">:</a> <a class="PrimitiveType" id="14565">Set</a> <a class="Bound" href="Data.FingerTree.html#14557" id="14569">a</a><a class="Symbol" id="14570">)</a> <a class="Symbol" id="14572">⦃</a> <a class="Bound" href="Data.FingerTree.html#14574" id="14574">_</a> <a class="Symbol" id="14576">:</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="14578">σ</a> <a class="Bound" href="Data.FingerTree.html#14561" id="14580">Σ</a> <a class="Symbol" id="14582">⦄</a> <a class="Symbol" id="14584">(</a><a class="Bound" href="Data.FingerTree.html#14585" id="14585">𝓂</a> <a class="Symbol" id="14587">:</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2603" id="14589">𝓡</a><a class="Symbol" id="14590">)</a> <a class="Symbol" id="14592">:</a> <a class="PrimitiveType" id="14594">Set</a> <a class="Symbol" id="14598">(</a><a class="Bound" href="Data.FingerTree.html#14557" id="14599">a</a> <a class="Primitive Operator" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#657" id="14601">⊔</a> <a class="Bound" href="Data.FingerTree.html#2872" id="14603">c</a> <a class="Primitive Operator" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#657" id="14605">⊔</a> <a class="Bound" href="Data.FingerTree.html#2874" id="14607">m</a><a class="Symbol" id="14608">)</a> <a class="Keyword" id="14610">where</a>
   <a class="Keyword" id="14619">constructor</a> <a id="Fibre.μ⟨_⟩≈_._⇑[_]"></a><a class="InductiveConstructor Operator" href="Data.FingerTree.html#14631" id="14631">_⇑[_]</a>
   <a class="Keyword" id="14640">field</a>
     <a id="Fibre.μ⟨_⟩≈_.𝓢"></a><a class="Field" href="Data.FingerTree.html#14651" id="14651">𝓢</a> <a class="Symbol" id="14653">:</a> <a class="Bound" href="Data.FingerTree.html#14561" id="14655">Σ</a>
     <a id="Fibre.μ⟨_⟩≈_.𝒻"></a><a class="Field" href="Data.FingerTree.html#14662" id="14662">𝒻</a> <a class="Symbol" id="14664">:</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="14666">μ</a> <a class="Field" href="Data.FingerTree.html#14651" id="14668">𝓢</a> <a class="Function Operator" href="https://agda.github.io/agda-stdlib/Algebra.html#2624" id="14670">≈</a> <a class="Bound" href="Data.FingerTree.html#14585" id="14672">𝓂</a>
 <a class="Keyword" id="14675">open</a> <a class="Module Operator" href="Data.FingerTree.html#14549" id="14680">μ⟨_⟩≈_</a>

<a class="Comment" id="14688">-- Technically speaking, I think this is known as a "fibre". μ⟨ Σ ⟩≈ 𝓂 means "There</a>
<a class="Comment" id="14772">-- exists a Σ such that μ Σ ≈ 𝓂". Next, we'll need some combinators to work</a>
<a class="Comment" id="14848">-- with:</a>

 <a class="Keyword" id="14859">infixl</a> <a class="Number" id="14866">2</a> <a class="Function Operator" href="Data.FingerTree.html#14875" id="14868">_≈[_]</a>
 <a id="Fibre._≈[_]"></a><a class="Function Operator" href="Data.FingerTree.html#14875" id="14875">_≈[_]</a> <a class="Symbol" id="14881">:</a> <a class="Symbol" id="14883">∀</a> <a class="Symbol" id="14885">{</a><a class="Bound" href="Data.FingerTree.html#14886" id="14886">a</a><a class="Symbol" id="14887">}</a> <a class="Symbol" id="14889">{</a><a class="Bound" href="Data.FingerTree.html#14890" id="14890">Σ</a> <a class="Symbol" id="14892">:</a> <a class="PrimitiveType" id="14894">Set</a> <a class="Bound" href="Data.FingerTree.html#14886" id="14898">a</a><a class="Symbol" id="14899">}</a> <a class="Symbol" id="14901">⦃</a> <a class="Bound" href="Data.FingerTree.html#14903" id="14903">_</a> <a class="Symbol" id="14905">:</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="14907">σ</a> <a class="Bound" href="Data.FingerTree.html#14890" id="14909">Σ</a> <a class="Symbol" id="14911">⦄</a> <a class="Symbol" id="14913">{</a><a class="Bound" href="Data.FingerTree.html#14914" id="14914">x</a> <a class="Symbol" id="14916">:</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2603" id="14918">𝓡</a><a class="Symbol" id="14919">}</a> <a class="Symbol" id="14921">→</a> <a class="Record Operator" href="Data.FingerTree.html#14549" id="14923">μ⟨</a> <a class="Bound" href="Data.FingerTree.html#14890" id="14926">Σ</a> <a class="Record Operator" href="Data.FingerTree.html#14549" id="14928">⟩≈</a> <a class="Bound" href="Data.FingerTree.html#14914" id="14931">x</a> <a class="Symbol" id="14933">→</a> <a class="Symbol" id="14935">∀</a> <a class="Symbol" id="14937">{</a><a class="Bound" href="Data.FingerTree.html#14938" id="14938">y</a><a class="Symbol" id="14939">}</a> <a class="Symbol" id="14941">→</a> <a class="Bound" href="Data.FingerTree.html#14914" id="14943">x</a> <a class="Function Operator" href="https://agda.github.io/agda-stdlib/Algebra.html#2624" id="14945">≈</a> <a class="Bound" href="Data.FingerTree.html#14938" id="14947">y</a> <a class="Symbol" id="14949">→</a> <a class="Record Operator" href="Data.FingerTree.html#14549" id="14951">μ⟨</a> <a class="Bound" href="Data.FingerTree.html#14890" id="14954">Σ</a> <a class="Record Operator" href="Data.FingerTree.html#14549" id="14956">⟩≈</a> <a class="Bound" href="Data.FingerTree.html#14938" id="14959">y</a>
 <a class="Field" href="Data.FingerTree.html#14651" id="14962">𝓢</a> <a class="Symbol" id="14964">(</a><a class="Bound" href="Data.FingerTree.html#14965" id="14965">xs</a> <a class="Function Operator" href="Data.FingerTree.html#14875" id="14968">≈[</a> <a class="Bound" href="Data.FingerTree.html#14971" id="14971">y≈z</a> <a class="Function Operator" href="Data.FingerTree.html#14875" id="14975">]</a><a class="Symbol" id="14976">)</a> <a class="Symbol" id="14978">=</a> <a class="Field" href="Data.FingerTree.html#14651" id="14980">𝓢</a> <a class="Bound" href="Data.FingerTree.html#14965" id="14982">xs</a>
 <a class="Field" href="Data.FingerTree.html#14662" id="14986">𝒻</a> <a class="Symbol" id="14988">(</a><a class="Bound" href="Data.FingerTree.html#14989" id="14989">xs</a> <a class="Function Operator" href="Data.FingerTree.html#14875" id="14992">≈[</a> <a class="Bound" href="Data.FingerTree.html#14995" id="14995">y≈z</a> <a class="Function Operator" href="Data.FingerTree.html#14875" id="14999">]</a><a class="Symbol" id="15000">)</a> <a class="Symbol" id="15002">=</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Relation.Binary.Core.html#5860" id="15004">trans</a> <a class="Symbol" id="15010">(</a><a class="Field" href="Data.FingerTree.html#14662" id="15011">𝒻</a> <a class="Bound" href="Data.FingerTree.html#14989" id="15013">xs</a><a class="Symbol" id="15015">)</a> <a class="Bound" href="Data.FingerTree.html#14995" id="15017">y≈z</a>

<a class="Comment" id="15022">-- This makes it possible to "rewrite" the summary, given a proof of equivalence.</a>

<a class="Keyword" id="15105">open</a> <a class="Module" href="Data.FingerTree.html#2976" id="15110">Measures</a> <a class="Keyword" id="15119">using</a> <a class="Symbol" id="15125">(</a><a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="15126">μ⟨_⟩≈_</a><a class="Symbol" id="15132">;</a> <a class="Field" href="Data.FingerTree.Measures.html#744" id="15134">𝓢</a><a class="Symbol" id="15135">;</a> <a class="Field" href="Data.FingerTree.Measures.html#754" id="15137">𝒻</a><a class="Symbol" id="15138">;</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#1444" id="15140">_≈[_]</a><a class="Symbol" id="15145">)</a>
<a class="Comment" id="15147">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="15231">-- │                                                                              │</a>
<a class="Comment" id="15315">-- │                                                                              │</a>
<a class="Comment" id="15399">-- │                                                                              │</a>
<a class="Comment" id="15483">-- │                                                                              │</a>
<a class="Comment" id="15567">-- │                                                                              │</a>
<a class="Comment" id="15651">-- │             ____          _   _       _        _   _                         │</a>
<a class="Comment" id="15735">-- │            |  _ \  ___   | \ | | ___ | |_ __ _| |_(_) ___  _ __              │</a>
<a class="Comment" id="15819">-- │            | | | |/ _ \  |  \| |/ _ \| __/ _` | __| |/ _ \| '_ \             │</a>
<a class="Comment" id="15903">-- │            | |_| | (_) | | |\  | (_) | || (_| | |_| | (_) | | | |            │</a>
<a class="Comment" id="15987">-- │            |____/ \___/  |_| \_|\___/ \__\__,_|\__|_|\___/|_| |_|            │</a>
<a class="Comment" id="16071">-- │                                                                              │</a>
<a class="Comment" id="16155">-- │                                                                              │</a>
<a class="Comment" id="16239">-- │                                                                              │</a>
<a class="Comment" id="16323">-- │                                                                              │</a>
<a class="Comment" id="16407">-- │                                                                              │</a>
<a class="Comment" id="16491">-- └──────────────────────────────────────────────────────────────────────────────┘</a>
<a class="Keyword" id="16575">module</a> <a id="ArgSyntax"></a><a class="Module" href="Data.FingerTree.html#16582" id="16582">ArgSyntax</a> <a class="Keyword" id="16592">where</a>

<a class="Comment" id="16599">-- The wrapper on its own isn't enough to save us from hundreds of lines of proofs.</a>
<a class="Comment" id="16683">-- Once you do computation on its contents, you still need to join it up with its</a>
<a class="Comment" id="16765">-- original proof of equivalence. In other words, you'll need to drill into the</a>
<a class="Comment" id="16845">-- return type of a function, find the place you used the relevant type variable,</a>
<a class="Comment" id="16927">-- and apply the relevant proof from the type above. This can really clutter</a>
<a class="Comment" id="17004">-- proofs. Instead, we can use Agda's new support for do notation to try and get a</a>
<a class="Comment" id="17087">-- cleaner notation for everything. Here's a big block of code:</a>
 <a class="Keyword" id="17152">infixl</a> <a class="Number" id="17159">2</a> <a class="InductiveConstructor" href="Data.FingerTree.html#17271" id="17161">arg-syntax</a>
 <a class="Keyword" id="17173">record</a> <a id="ArgSyntax.Arg"></a><a class="Record" href="Data.FingerTree.html#17180" id="17180">Arg</a> <a class="Symbol" id="17184">{</a><a class="Bound" href="Data.FingerTree.html#17185" id="17185">a</a><a class="Symbol" id="17186">}</a> <a class="Symbol" id="17188">(</a><a class="Bound" href="Data.FingerTree.html#17189" id="17189">Σ</a> <a class="Symbol" id="17191">:</a> <a class="PrimitiveType" id="17193">Set</a> <a class="Bound" href="Data.FingerTree.html#17185" id="17197">a</a><a class="Symbol" id="17198">)</a> <a class="Symbol" id="17200">⦃</a> <a class="Bound" href="Data.FingerTree.html#17202" id="17202">_</a> <a class="Symbol" id="17204">:</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="17206">σ</a> <a class="Bound" href="Data.FingerTree.html#17189" id="17208">Σ</a> <a class="Symbol" id="17210">⦄</a> <a class="Symbol" id="17212">(</a><a class="Bound" href="Data.FingerTree.html#17213" id="17213">𝓂</a> <a class="Symbol" id="17215">:</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2603" id="17217">𝓡</a><a class="Symbol" id="17218">)</a> <a class="Symbol" id="17220">(</a><a class="Bound" href="Data.FingerTree.html#17221" id="17221">f</a> <a class="Symbol" id="17223">:</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2603" id="17225">𝓡</a> <a class="Symbol" id="17227">→</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.html#2603" id="17229">𝓡</a><a class="Symbol" id="17230">)</a> <a class="Symbol" id="17232">:</a> <a class="PrimitiveType" id="17234">Set</a> <a class="Symbol" id="17238">(</a><a class="Bound" href="Data.FingerTree.html#2874" id="17239">m</a> <a class="Primitive Operator" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#657" id="17241">⊔</a> <a class="Bound" href="Data.FingerTree.html#2872" id="17243">c</a> <a class="Primitive Operator" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#657" id="17245">⊔</a> <a class="Bound" href="Data.FingerTree.html#17185" id="17247">a</a><a class="Symbol" id="17248">)</a> <a class="Keyword" id="17250">where</a>
   <a class="Keyword" id="17259">constructor</a> <a id="ArgSyntax.Arg.arg-syntax"></a><a class="InductiveConstructor" href="Data.FingerTree.html#17271" id="17271">arg-syntax</a>
   <a class="Keyword" id="17285">field</a>
     <a id="ArgSyntax.Arg.⟨f⟩"></a><a class="Field" href="Data.FingerTree.html#17296" id="17296">⟨f⟩</a> <a class="Symbol" id="17300">:</a> <a class="Function" href="https://agda.github.io/agda-stdlib/Algebra.FunctionProperties.html#2790" id="17302">Congruent₁</a> <a class="Bound" href="Data.FingerTree.html#17221" id="17313">f</a>
     <a id="ArgSyntax.Arg.arg"></a><a class="Field" href="Data.FingerTree.html#17320" id="17320">arg</a> <a class="Symbol" id="17324">:</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="17326">μ⟨</a> <a class="Bound" href="Data.FingerTree.html#17189" id="17329">Σ</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="17331">⟩≈</a> <a class="Bound" href="Data.FingerTree.html#17213" id="17334">𝓂</a>
 <a class="Keyword" id="17337">open</a> <a class="Module" href="Data.FingerTree.html#17180" id="17342">Arg</a>

 <a class="Keyword" id="17348">syntax</a> <a class="InductiveConstructor" href="Data.FingerTree.html#17271" id="17355">arg-syntax</a> <a class="Symbol" id="17366">(λ</a> sz <a class="Symbol" id="17372">→</a> e₁<a class="Symbol" id="17376">)</a> xs <a class="Symbol" id="17381">=</a> xs [ e₁ ⟿ sz ]

 <a class="Keyword" id="17400">infixl</a> <a class="Number" id="17407">1</a> <a class="Function Operator" href="Data.FingerTree.html#17416" id="17409">_&gt;&gt;=_</a>
 <a id="ArgSyntax._&gt;&gt;=_"></a><a class="Function Operator" href="Data.FingerTree.html#17416" id="17416">_&gt;&gt;=_</a> <a class="Symbol" id="17422">:</a> <a class="Symbol" id="17424">∀</a> <a class="Symbol" id="17426">{</a><a class="Bound" href="Data.FingerTree.html#17427" id="17427">a</a> <a class="Bound" href="Data.FingerTree.html#17429" id="17429">b</a><a class="Symbol" id="17430">}</a> <a class="Symbol" id="17432">{</a><a class="Bound" href="Data.FingerTree.html#17433" id="17433">Σ₁</a> <a class="Symbol" id="17436">:</a> <a class="PrimitiveType" id="17438">Set</a> <a class="Bound" href="Data.FingerTree.html#17427" id="17442">a</a><a class="Symbol" id="17443">}</a> <a class="Symbol" id="17445">{</a><a class="Bound" href="Data.FingerTree.html#17446" id="17446">Σ₂</a> <a class="Symbol" id="17449">:</a> <a class="PrimitiveType" id="17451">Set</a> <a class="Bound" href="Data.FingerTree.html#17429" id="17455">b</a><a class="Symbol" id="17456">}</a> <a class="Symbol" id="17458">⦃</a> <a class="Bound" href="Data.FingerTree.html#17460" id="17460">_</a> <a class="Symbol" id="17462">:</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="17464">σ</a> <a class="Bound" href="Data.FingerTree.html#17433" id="17466">Σ₁</a> <a class="Symbol" id="17469">⦄</a> <a class="Symbol" id="17471">⦃</a> <a class="Bound" href="Data.FingerTree.html#17473" id="17473">_</a> <a class="Symbol" id="17475">:</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="17477">σ</a> <a class="Bound" href="Data.FingerTree.html#17446" id="17479">Σ₂</a> <a class="Symbol" id="17482">⦄</a> <a class="Symbol" id="17484">{</a><a class="Bound" href="Data.FingerTree.html#17485" id="17485">𝓂</a> <a class="Bound" href="Data.FingerTree.html#17487" id="17487">f</a><a class="Symbol" id="17488">}</a>
       <a class="Symbol" id="17497">→</a> <a class="Record" href="Data.FingerTree.html#17180" id="17499">Arg</a> <a class="Bound" href="Data.FingerTree.html#17433" id="17503">Σ₁</a> <a class="Bound" href="Data.FingerTree.html#17485" id="17506">𝓂</a> <a class="Bound" href="Data.FingerTree.html#17487" id="17508">f</a>
       <a class="Symbol" id="17517">→</a> <a class="Symbol" id="17519">((</a><a class="Bound" href="Data.FingerTree.html#17521" id="17521">x</a> <a class="Symbol" id="17523">:</a> <a class="Bound" href="Data.FingerTree.html#17433" id="17525">Σ₁</a><a class="Symbol" id="17527">)</a> <a class="Symbol" id="17529">→</a> <a class="Symbol" id="17531">⦃</a> <a class="Bound" href="Data.FingerTree.html#17533" id="17533">x≈</a> <a class="Symbol" id="17536">:</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="17538">μ</a> <a class="Bound" href="Data.FingerTree.html#17521" id="17540">x</a> <a class="Function Operator" href="https://agda.github.io/agda-stdlib/Algebra.html#2624" id="17542">≈</a> <a class="Bound" href="Data.FingerTree.html#17485" id="17544">𝓂</a> <a class="Symbol" id="17546">⦄</a> <a class="Symbol" id="17548">→</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="17550">μ⟨</a> <a class="Bound" href="Data.FingerTree.html#17446" id="17553">Σ₂</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="17556">⟩≈</a> <a class="Bound" href="Data.FingerTree.html#17487" id="17559">f</a> <a class="Symbol" id="17561">(</a><a class="Field" href="Data.FingerTree.Measures.html#361" id="17562">μ</a> <a class="Bound" href="Data.FingerTree.html#17521" id="17564">x</a><a class="Symbol" id="17565">))</a>
       <a class="Symbol" id="17575">→</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="17577">μ⟨</a> <a class="Bound" href="Data.FingerTree.html#17446" id="17580">Σ₂</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="17583">⟩≈</a> <a class="Bound" href="Data.FingerTree.html#17487" id="17586">f</a> <a class="Bound" href="Data.FingerTree.html#17485" id="17588">𝓂</a>
 <a class="InductiveConstructor" href="Data.FingerTree.html#17271" id="17591">arg-syntax</a> <a class="Bound" href="Data.FingerTree.html#17602" id="17602">cng</a> <a class="Bound" href="Data.FingerTree.html#17606" id="17606">xs</a> <a class="Function Operator" href="Data.FingerTree.html#17416" id="17609">&gt;&gt;=</a> <a class="Bound" href="Data.FingerTree.html#17613" id="17613">k</a> <a class="Symbol" id="17615">=</a> <a class="Bound" href="Data.FingerTree.html#17613" id="17617">k</a> <a class="Symbol" id="17619">(</a><a class="Field" href="Data.FingerTree.Measures.html#744" id="17620">𝓢</a> <a class="Bound" href="Data.FingerTree.html#17606" id="17622">xs</a><a class="Symbol" id="17624">)</a> <a class="Symbol" id="17626">⦃</a> <a class="Field" href="Data.FingerTree.Measures.html#754" id="17628">𝒻</a> <a class="Bound" href="Data.FingerTree.html#17606" id="17630">xs</a> <a class="Symbol" id="17633">⦄</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#1444" id="17635">≈[</a> <a class="Bound" href="Data.FingerTree.html#17602" id="17638">cng</a> <a class="Symbol" id="17642">(</a><a class="Field" href="Data.FingerTree.Measures.html#754" id="17643">𝒻</a> <a class="Bound" href="Data.FingerTree.html#17606" id="17645">xs</a><a class="Symbol" id="17647">)</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#1444" id="17649">]</a>

<a class="Comment" id="17652">-- First, we define a wrapper for types parameterised by their summary, with a way</a>
<a class="Comment" id="17735">-- to lift an underlying equality up into some expression f. The &gt;&gt;= operator</a>
<a class="Comment" id="17813">-- just connects up all of the relevant bits. An example is what's needed:</a>

<a class="Keyword" id="17889">open</a> <a class="Module" href="Data.FingerTree.html#2976" id="17894">Measures</a> <a class="Keyword" id="17903">using</a> <a class="Symbol" id="17909">(</a><a class="InductiveConstructor" href="Data.FingerTree.Measures.html#2635" id="17910">arg-syntax</a><a class="Symbol" id="17920">;</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#3143" id="17922">_&gt;&gt;=_</a><a class="Symbol" id="17927">)</a>

<a id="listToTree"></a><a class="Function" href="Data.FingerTree.html#17930" id="17930">listToTree</a> <a class="Symbol" id="17941">:</a> <a class="Symbol" id="17943">∀</a> <a class="Symbol" id="17945">{</a><a class="Bound" href="Data.FingerTree.html#17946" id="17946">a</a><a class="Symbol" id="17947">}</a> <a class="Symbol" id="17949">{</a><a class="Bound" href="Data.FingerTree.html#17950" id="17950">Σ</a> <a class="Symbol" id="17952">:</a> <a class="PrimitiveType" id="17954">Set</a> <a class="Bound" href="Data.FingerTree.html#17946" id="17958">a</a><a class="Symbol" id="17959">}</a> <a class="Symbol" id="17961">⦃</a> <a class="Bound" href="Data.FingerTree.html#17963" id="17963">_</a> <a class="Symbol" id="17965">:</a> <a class="Record" href="Data.FingerTree.Measures.html#317" id="17967">σ</a> <a class="Bound" href="Data.FingerTree.html#17950" id="17969">Σ</a> <a class="Symbol" id="17971">⦄</a> <a class="Symbol" id="17973">→</a> <a class="Symbol" id="17975">(</a><a class="Bound" href="Data.FingerTree.html#17976" id="17976">xs</a> <a class="Symbol" id="17979">:</a> <a class="Datatype" href="https://agda.github.io/agda-stdlib/Agda.Builtin.List.html#80" id="17981">List</a> <a class="Bound" href="Data.FingerTree.html#17950" id="17986">Σ</a><a class="Symbol" id="17987">)</a> <a class="Symbol" id="17989">→</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="17991">μ⟨</a> <a class="Datatype" href="Data.FingerTree.Structures.html#1236" id="17994">Tree</a> <a class="Bound" href="Data.FingerTree.html#17950" id="17999">Σ</a> <a class="Record Operator" href="Data.FingerTree.Measures.html#645" id="18001">⟩≈</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="18004">μ</a> <a class="Bound" href="Data.FingerTree.html#17976" id="18006">xs</a>
<a class="Function" href="Data.FingerTree.html#17930" id="18009">listToTree</a> <a class="InductiveConstructor" href="https://agda.github.io/agda-stdlib/Agda.Builtin.List.html#117" id="18020">[]</a> <a class="Symbol" id="18023">=</a> <a class="InductiveConstructor" href="Data.FingerTree.Structures.html#1297" id="18025">empty</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#872" id="18031">⇑</a>
<a class="Function" href="Data.FingerTree.html#17930" id="18033">listToTree</a> <a class="Symbol" id="18044">(</a><a class="Bound" href="Data.FingerTree.html#18045" id="18045">x</a> <a class="InductiveConstructor Operator" href="https://agda.github.io/agda-stdlib/Agda.Builtin.List.html#132" id="18047">∷</a> <a class="Bound" href="Data.FingerTree.html#18049" id="18049">xs</a><a class="Symbol" id="18051">)</a> <a class="Symbol" id="18053">=</a> <a class="Function" href="Data.FingerTree.Measures.html#1833" id="18055">[</a> <a class="Field" href="Data.FingerTree.Preamble.html#421" id="18057">ℳ</a> <a class="Macro Operator" href="Data.FingerTree.Reasoning.html#295" id="18059">↯</a> <a class="Function" href="Data.FingerTree.Measures.html#1833" id="18061">]≈</a> <a class="Keyword" id="18064">do</a>
  <a class="Bound" href="Data.FingerTree.html#18069" id="18069">ys</a> <a class="Function Operator" href="Data.FingerTree.Measures.html#3143" id="18072">←</a> <a class="Function" href="Data.FingerTree.html#17930" id="18074">listToTree</a> <a class="Bound" href="Data.FingerTree.html#18049" id="18085">xs</a> <a class="InductiveConstructor" href="Data.FingerTree.Measures.html#2635" id="18088">[</a> <a class="Field" href="Data.FingerTree.Measures.html#361" id="18090">μ</a> <a class="Bound" href="Data.FingerTree.html#18045" id="18092">x</a> <a class="Function Operator" href="Data.FingerTree.Reasoning.html#957" id="18094">∙&gt;</a> <a class="Bound" href="Data.FingerTree.html#18101" id="18097">s</a> <a class="InductiveConstructor" href="Data.FingerTree.Measures.html#2635" id="18099">⟿</a> <a class="Bound" href="Data.FingerTree.html#18101" id="18101">s</a> <a class="InductiveConstructor" href="Data.FingerTree.Measures.html#2635" id="18103">]</a>
  <a class="Bound" href="Data.FingerTree.html#18045" id="18107">x</a> <a class="Function Operator" href="Data.FingerTree.Cons.html#447" id="18109">◂</a> <a class="Bound" href="Data.FingerTree.html#18069" id="18111">ys</a>

<a class="Comment" id="18115">-- The first line is the base case, nothing interesting going on there. The second</a>
<a class="Comment" id="18198">-- line begins the do-notation, but first applies [ ℳ ↯ ]≈: this calls the</a>
<a class="Comment" id="18273">-- automated solver. The second line makes the recursive call, and with the syntax:</a>
<a class="Comment" id="18357">--</a>
<a class="Comment" id="18360">--   [ μ x ∙&gt; s ⟿ s ]</a>
<a class="Comment" id="18382">--</a>
<a class="Comment" id="18385">-- It tells us where the size of the bound variable will end up in the outer</a>
<a class="Comment" id="18462">-- expression.</a>

<a class="Comment" id="18478">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="18562">-- │                                                                              │</a>
<a class="Comment" id="18646">-- │                                                                              │</a>
<a class="Comment" id="18730">-- │                                                                              │</a>
<a class="Comment" id="18814">-- │                                                                              │</a>
<a class="Comment" id="18898">-- │                                                                              │</a>
<a class="Comment" id="18982">-- │                     __  __           _       _                               │</a>
<a class="Comment" id="19066">-- │                    |  \/  | ___   __| |_   _| | ___  ___                     │</a>
<a class="Comment" id="19150">-- │                    | |\/| |/ _ \ / _` | | | | |/ _ \/ __|                    │</a>
<a class="Comment" id="19234">-- │                    | |  | | (_) | (_| | |_| | |  __/\__ \                    │</a>
<a class="Comment" id="19318">-- │                    |_|  |_|\___/ \__,_|\__,_|_|\___||___/                    │</a>
<a class="Comment" id="19402">-- │                                                                              │</a>
<a class="Comment" id="19486">-- │                                                                              │</a>
<a class="Comment" id="19570">-- │                                                                              │</a>
<a class="Comment" id="19654">-- │                                                                              │</a>
<a class="Comment" id="19738">-- │                                                                              │</a>
<a class="Comment" id="19822">-- └──────────────────────────────────────────────────────────────────────────────┘</a>

<a class="Comment" id="19907">-- Definition of Measures and so on</a>
<a class="Keyword" id="19943">import</a> <a class="Module" href="Data.FingerTree.Measures.html" id="19950">Data.FingerTree.Measures</a>

<a class="Comment" id="19976">-- Tools for writing proofs</a>
<a class="Keyword" id="20004">import</a> <a class="Module" href="Data.FingerTree.Reasoning.html" id="20011">Data.FingerTree.Reasoning</a>

<a class="Comment" id="20038">-- The finger tree type</a>
<a class="Keyword" id="20062">import</a> <a class="Module" href="Data.FingerTree.Structures.html" id="20069">Data.FingerTree.Structures</a>

<a class="Comment" id="20097">-- Cons and Snoc</a>
<a class="Keyword" id="20114">import</a> <a class="Module" href="Data.FingerTree.Cons.html" id="20121">Data.FingerTree.Cons</a>

<a class="Comment" id="20143">-- Uncons and Unsnoc</a>
<a class="Keyword" id="20164">import</a> <a class="Module" href="Data.FingerTree.View.html" id="20171">Data.FingerTree.View</a>

<a class="Comment" id="20193">-- Split</a>
<a class="Keyword" id="20202">import</a> <a class="Module" href="Data.FingerTree.Split.html" id="20209">Data.FingerTree.Split</a>

<a class="Comment" id="20232">-- ┌──────────────────────────────────────────────────────────────────────────────┐</a>
<a class="Comment" id="20316">-- │                    ___      __                                               │</a>
<a class="Comment" id="20400">-- │                   | _ \___ / _|___ _ _ ___ _ _  __ ___ ___                   │</a>
<a class="Comment" id="20484">-- │                   |   / -_)  _/ -_) '_/ -_) ' \/ _/ -_|_-&lt;                   │</a>
<a class="Comment" id="20568">-- │                   |_|_\___|_| \___|_| \___|_||_\__\___/__/                   │</a>
<a class="Comment" id="20652">-- │                                                                              │</a>
<a class="Comment" id="20736">-- └──────────────────────────────────────────────────────────────────────────────┘</a>

<a class="Comment" id="20821">-- [1]</a>
<a class="Comment" id="20828">-- Mu, Shin-Cheng, Yu-Hsi Chiang, and Yu-Han Lyu. 2016. “Queueing and Glueing for</a>
<a class="Comment" id="20910">-- Optimal Partitioning (Functional Pearl).” In Proceedings of the 21st ACM SIGPLAN</a>
<a class="Comment" id="20994">-- International Conference on Functional Programming, 158–167. ICFP 2016. New</a>
<a class="Comment" id="21073">-- York, NY, USA: ACM. doi:10.1145/2951913.2951923.</a>
<a class="Comment" id="21125">-- https://www.iis.sinica.edu.tw/~scm/pub/queueing-glueing.pdf.</a>

<a class="Comment" id="21190">-- [2]</a>
<a class="Comment" id="21197">-- Hinze, Ralf, and Ross Paterson. 2006. “Finger Trees: A Simple General-purpose</a>
<a class="Comment" id="21278">-- Data Structure.” Journal of Functional Programming 16 (2): 197–217.</a>
<a class="Comment" id="21349">-- http://www.staff.city.ac.uk/~ross/papers/FingerTree.html.</a>

<a class="Comment" id="21411">-- [3]</a>
<a class="Comment" id="21418">-- Hinze, Ralf. 2001. “A Simple Implementation Technique for Priority Search</a>
<a class="Comment" id="21495">-- Queues.” In Proceedings of the 2001 International Conference on Functional</a>
<a class="Comment" id="21573">-- Programming, 110–121. ACM Press. doi:10.1145/507635.507650.</a>
<a class="Comment" id="21636">-- https://www.cs.ox.ac.uk/people/ralf.hinze/publications/\#P14.</a>

<a class="Comment" id="21702">-- [4]</a>
<a class="Comment" id="21709">-- Sozeau, Matthieu. 2007. “Program-ing Finger Trees in Coq.” In Proceedings of the</a>
<a class="Comment" id="21793">-- 12th ACM SIGPLAN International Conference on Functional Programming, 13–24. ICFP</a>
<a class="Comment" id="21877">-- ’07. New York, NY, USA: ACM. doi:10.1145/1291151.1291156.</a>
<a class="Comment" id="21938">-- https://www.irif.fr/~sozeau/research/publications/Program-ing_Finger_Trees_in_Coq.pdf.</a>

<a class="Comment" id="22029">-- [5]</a>
<a class="Comment" id="22036">-- Danielsson, Nils Anders. 2008. “Lightweight Semiformal Time Complexity Analysis</a>
<a class="Comment" id="22119">-- for Purely Functional Data Structures.” In Proceedings of the 35th Annual ACM</a>
<a class="Comment" id="22200">-- SIGPLAN-SIGACT Symposium on Principles of Programming Languages, 133–144. POPL</a>
<a class="Comment" id="22282">-- ’08. New York, NY, USA: ACM. doi:10.1145/1328438.1328457.</a>
<a class="Comment" id="22343">-- http://www.cse.chalmers.se/~nad/publications/danielsson-popl2008.pdf.</a>



</pre></body></html>